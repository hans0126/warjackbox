/*
 warjack 2015-11-20 
*/
function warjackBox(){function a(a){if(!a)return void console.log("%c lose stage element!","background: #F00; color: #FFF");var b=D;switch(s.tableData.length){case 1:s.displayMode=0;break;case 2:s.displayMode=1}1==s.displayMode&&(b=2*D),editAreaRenderer=new PIXI.autoDetectRenderer(b,E),editAreaRenderer.roundPixels=!0,a.appendChild(editAreaRenderer.view),u.interactive=v.interactive=!0,u.buttonMode=!0,u.defaultCursor="crosshair",u.mousedown=v.mousedown=function(){A&&(B=!0)},u.mouseup=u.mouseout=v.mouseup=v.mouseout=function(){B=!1},c(u),c(v),t.addChild(u),t.addChild(v),u.hitArea=new PIXI.Rectangle(0,0,u.width,u.height),v.hitArea=new PIXI.Rectangle(0,0,v.width,v.height),u.idName="table",v.idName="table2",u.x=D/2-u.width/2,u.y=v.y=E/2-u.height/2,v.x=D+D/2-u.width/2,0===s.displayMode&&(v.visible=!1),m(),r()}function b(a,b){s.displayMode=a,0===a?(v.visible=!1,editAreaRenderer.resize(D,E),s.MCbind=!0):(v.visible=!0,editAreaRenderer.resize(2*D,E),s.MCbind=!1),"function"==typeof b&&b()}function c(a){for(var b=0;6>b;b++)for(var c=0;6>c;c++){var g=new PIXI.Container,h=new PIXI.Graphics,i=c*w+5*c,j=b*x+5*b;txt=new PIXI.Text("",{font:"36px Arial",fill:"black"}),txt.x=w/2-txt.width/2,txt.y=x/2-txt.height/2,g.x=i,g.y=j,g.width=w,g.height=x,g.interactive=!0,g.blockType="enabled",g.blockContent="-",g.origanlColor=C[0],h.beginFill(g.origanlColor),h.drawRect(0,0,w,x),h.endFill(),g.addChild(h),g.addChild(txt),g.mousedown=d,g.mouseover=e,g.mouseout=f,a.addChild(g)}}function d(){A&&g(this)}function e(){o(this.getChildAt(0),C[2],!0),B&&g(this)}function f(){o(this.getChildAt(0),this.origanlColor)}function g(a){function b(a,b){var c;return c=6>a?b?z[a]:y[a]:b?z[a%6]:y[a%6]}var c,d,e,f,g=a;if(s.mirrorMode){var h;switch(0===s.displayMode?(h=u.getChildIndex(a),d=b(h),c=u.getChildAt(h+d)):"table"==a.parent.idName?(h=u.getChildIndex(a),d=b(h),c=v.getChildAt(h+d)):(h=v.getChildIndex(a),d=b(h,!0),c=u.getChildAt(h-d)),A.font){case"L":e=s.LRbind?"R":A.font;break;case"R":e=s.LRbind?"L":A.font;break;case"M":e=s.MCbind?"C":A.font;break;case"C":e=s.MCbind?"M":A.font;break;case"S":e="S";break;default:e=A.font}}"disabled"==A.bType?(f=C[0],o(g.getChildAt(0),f,!0),p(g.getChildAt(1),"",!1),s.mirrorMode&&(o(c.getChildAt(0),f),p(c.getChildAt(1),"",!1))):(f=C[1],o(g.getChildAt(0),f,!0),s.mirrorMode&&o(c.getChildAt(0),f),A.font?(p(g.getChildAt(1),A.font,!0),s.mirrorMode&&p(c.getChildAt(1),e,!0)):(g.getChildAt(1).visible=!1,s.mirrorMode&&(c.getChildAt(1).visible=!1))),g.blockType=A.bType,g.blockContent=A.font,g.origanlColor=f,s.mirrorMode&&(c.blockType=A.bType,c.blockContent=e,c.origanlColor=f)}function h(a){for(var b=[u,v],c=0;c<b.length;c++)for(var d=0;d<b[c].children.length;d++){var e=b[c].getChildAt(d);o(e.getChildAt(0),C[0]),e.getChildAt(1).visible=!1,e.blockType="enabled",e.blockContent="-",e.origanlColor=C[0]}"function"==typeof a&&a(k())}function i(){return editAreaRenderer.render(t),editAreaRenderer.view.toDataURL("image/png")}function j(a){switch(a){case"disabled":A={bType:a,font:""};break;case"enabled":A={bType:a,font:""};break;default:A={bType:"enabled",font:a}}}function k(){var a,b=[u,v],c=[];a=0===s.displayMode?1:2;for(var d=0;a>d;d++){for(var e=[],f=0;6>f;f++)e[f]=[];for(var g=0;g<b[d].children.length;g++){var h="-";h="disabled"==b[d].getChildAt(g).blockType?"-":""!==b[d].getChildAt(g).blockContent?b[d].getChildAt(g).blockContent:"+",e[Math.floor(g/6)].push(h)}c.push(e)}return c}function l(a){s.tableData=a,m()}function m(){for(var a=[u,v],b=0;b<s.tableData.length;b++)n(s.tableData[b],a[b])}function n(a,b){for(var c=/[clmrgis+-]/gi,d=[],e=0,f=0;f<a.length;f++){d[f]=[];for(var g=a[f],h=0;h<g.length;h++){var i=g[h].match(c);i?d[f].push(i[0].toUpperCase()):d[f].push("-")}}a:for(var j=0;j<d.length;j++)for(var k=0;k<d[j].length;k++){var l,m,n,q,r=b.getChildAt(e);if("-"==d[j][k]?(q="disabled",l=C[0],m="",n=!1):(q="enabled",l=C[1],m="",n=!0,"+"!=d[j][k]&&(m=d[j][k])),o(r.getChildAt(0),l),p(r.getChildAt(1),m,n),r.origanlColor=l,r.blockType=q,r.blockContent=m,e++,36==e)break a}}function o(a,b,c){a.clear(),a.beginFill(b),c&&a.lineStyle(2,16711680),a.drawRect(0,0,w,x),a.endFill()}function p(a,b,c){a.visible=c,a.text=b,a.x=w/2-a.width/2,a.y=x/2-a.height/2}function q(a){var b,c=[],d=0;b="object"==typeof a?a:k();for(var e=0;e<b.length;e++)for(var f=0;f<b[e].length;f++)for(var g=0;g<b[e][f].length;g++){var h=b[e][f][g];-1==c.indexOf(h)&&"+"!=h&&"-"!=h&&c.push(h),"-"!=h&&d++}return{life:d,system:c}}function r(){s.requestAnime=window.requestAnimFrame(r),editAreaRenderer.render(t)}var s=this;s.init=a,s.getBrush=j,s.resetTable=h,s.changeDataRender=l,s.getDataArray=k,s.changeMode=b,s.exportImg=i,s.getTotalType=q,s.mirrorMode=!1,s.displayMode=0,s.LRbind=!0,s.MCbind=!0,s.tableData=[],s.requestAnime=null;var t=new PIXI.Container,u=new PIXI.Container,v=new PIXI.Container,w=40,x=40,y=[5,3,1,-1,-3,-5],z=[-5,-3,-1,1,3,5],A={bType:"enabled",font:""},B=!1,C=[6710886,16777215,13421772],D=300,E=300}